# Виртуальная ЭВМ УРАЛ-1

**Цель проекта:** создать программный комплекс из средств разработки и симулятора для запуска виртуальной ЭВМ, построенной из простейших логических элементов.

**Задачи:**
1. Разработать симулятор, позволяющий конструировать и моделировать работу схем из простейших логических элементов - гейтов, таймеров и переключателей. Предусмотреть возможность создания более сложных элементов, как абстракций над примитивами и более простыми элементами. Заложить в симулятор базовый набор частей для построения сложных схем: декодеры, мультиплексоры, триггеры, регистры, тактовые генераторы, сумматоры и др. 
2. Разработать архитектуру аппаратной части виртуальной ЭВМ. Задокументировать ее на уровне компонентной схемы и текстового описания.
3. Собрать ЭВМ в симуляторе. 
4. Разработать язык ассемблера для разработки ПО под созданную виртуальную ЭВМ. Задокументировать возможности языка.
5. Написать ассемблер, компилирующий задокументированный язык в машинный код, пригодный для исполнения на виртуальной ЭВМ.
6. Написать редактор кода с подсветкой синтаксиса и возможностью выполнять компиляцию редактируемого файла в процессе разработки.
7. Написать набор стандартных библиотек для разработки. 


## Структура проекта

* `sml emulator/` - программа, эмулирующая работу виртуальной ЭВМ и внешних устройств на уровне логических элементов
    - `sml/elementary/` - примитивные логические элементы: гейты, таймеры и переключатели
    - `sml/parts/` - библиотека готовых частей, для построения сложных схем. Включает: тактовый генератор, устройство управления, декодер, мультиплексор, сумматор, регистровый файл, RAM, порт (компоновщик однотипных гейтов).
    - `ural1/` - описывает сложные составные части виртуальной ЭВМ: АЛУ и блок компараторов, а также саму виртуальную ЭВМ
* `docs/` - файлы документации на виртуальную ЭВМ и язык ассемблера для нее
* `compiler/` - ассемблер для виртуальной ЭВМ
    - `libraries/` - модули стандартной библиотеки языка ассемблера
* `editor/` - редактор кода с подсветкой синтаксиса для языка ассемблера
* `programms/` - примеры программ 


## Документация

Архитектура аппаратной части виртуальной ЭВМ представлена на схеме:

![scheme](docs/Принципиальная%20схема.png)

Текстовая документация доступна в онлайн виде:
- [аппаратная часть](https://docs.google.com/document/d/1_5jVHumN4gPAwXFGisuD8U_-uTulASd9lD8k6ShVqN4/edit?usp=sharing)
- [язык ассемблера](https://docs.google.com/document/d/1WFTV04HKOq-5g7y1oabNBc2lSpaqeTY0oYMkhR4MMT0/edit?usp=sharing)


## Технические решения

- Для моделирования частей схемы, состоящих из чрезмерно большого количества примитивных элементов, а также для частей, работа которых выходит за рамки моделируемой среды (внешние устройства) в эмуляторе предусмотрена возможность создания *виртуальных частей*: частей, имеющих как гейтовый интерфейс, так и программно заложенную логику. Например, память контроллера представлена виртуальной частью (данные считываются из портов и записываются в массив), а экран (устройство вывода) считывает команды из входных портов и формирует по ним изображение на дисплее (см. раздел "демонстрация возможностей")
- Архитектура устройства управления генерируется автоматически по таблице истинности (см. в `sml emulator/ural1/config.js`)
- Стек вызовов полностью реализуется программной частью ЭВМ (при этом в аппаратную реализацию заложен стек с максимальной глубиной 1)


## Краткое описание характеристик ЭВМ

- Разрядность: **8 бит**
- Объем RAM: **1 Кб** (256 байт для данных и 768 байт для инструкций)
- Регистров: **16**
- Портов вывода (register mapped): **2**
- Портов ввода (register mapped): **1**
- Источников прерываний: **1**

Поддерживаются инструкции:
- Доступа к данным в регстрах
- Доступа к данным в оперативной памяти
- Арифметических и логических операций над данными в регистрах
- Условных и безусловных переходов
- Выполнения процедур


## Демонстрация возможностей

Для демонстрации возможностей ЭВМ при помощи разработанного программного комплекса была написана программа, выполняющая wireframe rendering модели, вершины и ребра которой записываются в оперативной памяти. Основной код программы находится в файле `programms/renderer.ur1`. 

Также программа использует следующие модули стандартной библиотеки:
- `math.ur1` - модуль, программно реализующий математические операции.
- `screen.ur1` - драйвер для экрана (устройство вывода). Поддерживает отображение примитивов: заполнения экрана и линий (используется алгоритм Брейзенхема).

Программа считывает координаты вершин в оперативной памяти, выполняет их перспективную проекцию на экран, после чего соединяет линиями. 

Пример для модели "куб":

![cube](assets/rendered%20cube.jpg)

Пример для модели "пирамида":

![piramide](assets/rendered%20piramide.jpg)


## Идеи для развития

- Добавить адаптеры к физическим устройствам ввода: мышь, клавиатура. 
- Сделать более мощную виртуальную ЭВМ, заложить в нее привелигированный и пользовательский режимы работы. Написать ОС. 
- Оптимизировать эмулятор для ускорения симуляции. Тут я вижу 2 основных направления: перенос расчетов на GPU и предварительная обработка схемы для уменьшения числа элементов в комбинационных схемах.
- Смоделировать 2 или более виртуальных ЭВМ и организовать сеть для обмена данных между ними. Смоделировать сетевые устройства уровней L1-L3 OSI. Написать пакет стандартной библиотеки для сетевой коммуникации между машинами. 
- Разработать компилируемый ЯП для разработки под виртуальную ЭВМ.